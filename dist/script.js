'use strict';(function(C){"function"===typeof define&&define.amd?define(C):C()})(function(){function C(){function a(a){c[0].value[0]=a.alpha;c[0].value[1]=a.beta;c[0].value[2]=a.gamma}let d=!1,c=JSON.parse(JSON.stringify(I));return{get ustate(){return c},setup:function(){d||(d=!0,"function"===typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((b)=>{"granted"===b&&window.addEventListener("deviceorientation",a)}).catch(console.error):window.addEventListener("deviceorientation",
a))},dispose:function(){window.removeEventListener("deviceorientation",a)}}}function X(a){function d(a){console.log(a);h.add(a.targetElement)}function c(c){h.has(c.targetElement)?h.delete(c.targetElement):(c=a.createBufferSource(),c.buffer=a.createBuffer(1,1,a.sampleRate),c.connect(a.destination),c.start(0),"function"===typeof a.resume&&a.resume().then(b),e())}function b(){n.forEach((a)=>{a()})}function e(){g.forEach((a)=>{a.removeEventListener("touchstart",c);a.removeEventListener("touchmove",d);
a.removeEventListener("touchend",c);a.removeEventListener("mouseup",c)});g.clear();h.clear()}let h=new Set,g=new Set,n=[];return{onStart:function(b){"running"===a.state?(console.log("already"),b()):n.push(b)},register:function(a){a.addEventListener("touchstart",c);a.addEventListener("touchmove",d);a.addEventListener("touchend",c);a.addEventListener("mouseup",c);g.add(a)},dispose:e}}function A(){function a(a,c){if(a>l||c>k)a=Math.max(a,l),c=Math.max(c,k),a!==l&&(l=a,b.width=Math.floor(1*l)),c!==k&&
(k=c,b.height=Math.floor(1*k))}function d(a){let b=r?(a-r)/1E3:0;r=a;t[0].value+=b;t[1].value=b;t[3].value++;a=new Date;t[2].value[0]=a.getFullYear();t[2].value[1]=a.getMonth()+1;t[2].value[2]=a.getDate();t[2].value[3]=3600*a.getHours()+60*a.getMinutes()+a.getSeconds()+.001*a.getMilliseconds()}function c(e){if(q.size){d(e);var w=[...t,...h.ustate];q.forEach((c)=>c.render(b,a,l,k,1,w));m=requestAnimationFrame(c)}}let b=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),e=b.getContext("webgl")||
b.getContext("experimental-webgl"),h=C(),g=new (window.AudioContext||window.webkitAudioContext),n=new X(g);g.onStart=n.onStart;let l=0,k=0,m,r,q=new Set,t=JSON.parse(JSON.stringify(J));e.clearColor(0,0,0,0);return Object.freeze({get gl(){return e},get wa(){return g},addSurface:function(a){n.register(a.dom);a.addClick(h.setup);q.add(a);m||(m=requestAnimationFrame(c))},removeSurface:function(a){q.delete(a)},dispose:function(){q.forEach((a)=>a.dispose());q.clear();q=void 0;cancelAnimationFrame(m);h.dispose();
n.dispose()}})}function Y(a,d){let c={},b=a.getProgramParameter(d,a.ACTIVE_ATTRIBUTES);for(let e=0;e<b;e++){let {name:b}=a.getActiveAttrib(d,e);c[b]=a.getAttribLocation(d,b)}return c}function K(a){function d(){a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST)}let c,b,e=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,
e);let h=a.createTexture();if(!h)throw Error("createTexture returned null");a.bindTexture(a.TEXTURE_2D,h);d();a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,h,0);return{get handle(){return e},get texture(){return h},updateTexture:d,bind:function(){a.bindFramebuffer(a.FRAMEBUFFER,e);a.viewport(0,0,c,b)},updateResolution:function(d,e){if(d!==c||e!==b)c=d,b=e,a.bindTexture(a.TEXTURE_2D,h),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,d,e,0,a.RGBA,a.UNSIGNED_BYTE,null)},dispose:function(){a.deleteFramebuffer(e);
a.deleteTexture(h)}}}function L(a,d,c){d=a.createShader(d);a.shaderSource(d,c);a.compileShader(d);if(!a.getShaderParameter(d,a.COMPILE_STATUS)){let b=a.getShaderInfoLog(d);a.deleteShader(d);console.warn(b,"\nin shader:\n",c)}return d}function G(a,d){if(a.length!==d.length)return!1;for(let c=0,b=a.length;c<b;c++)if(a[c]!==d[c])return!1;return!0}function H(a,d){for(let c=0,b=d.length;c<b;c++)a[c]=d[c]}function Z(a,d,c,b){a[0]!==b&&(c.uniform1f(d,b),a[0]=b)}function aa(a,d,c,b){G(a,b)||(c.uniform2fv(d,
b),H(a,b))}function ba(a,d,c,b){G(a,b)||(c.uniform3fv(d,b),H(a,b))}function ca(a,d,c,b){G(a,b)||(c.uniform4fv(d,b),H(a,b))}function da(a,d,c,b){a[0]!==b&&(c.uniform1i(d,b),a[0]=b)}function ea(a){switch(a){case 5126:return Z;case 35664:return aa;case 35665:return ba;case 35666:return ca;case 35678:case 36198:return da}}function fa(a,d,c){let b=[],e=ea(d.type);return{get location(){return c},get name(){return d.name},setValue:function(){for(var d=arguments.length,g=Array(d),n=0;n<d;n++)g[n]=arguments[n];
e(b,c,a,...g)}}}function ha(a,d){let c={},b=a.getProgramParameter(d,a.ACTIVE_UNIFORMS);for(let h=0;h<b;h++){var e=a.getActiveUniform(d,h);let b=a.getUniformLocation(d,e.name);e=fa(a,e,b);c[e.name]=e}return c}function ia(a,d){if(d){let c=a.match(M);a=a.replace("mainImage","main");a=a.replace(M,"()");a=(c?"#define ".concat(c[1]," gl_FragColor\n#define ").concat(c[2]," gl_FragCoord.xy\n"):"")+a}a=ja(ka,d)+a;return"precision highp float;\n"+a}function la(a,d,c,b){function e(a){let b=f[D(a,g,"name")];
b&&b.setValue(D(a,g,"value"))}function h(b){b.forEach(e);v.forEach((a)=>a.update(e));y&&f.u_prevbuffer&&(b=f.u_prevbuffer)&&(b.setValue(p),a.activeTexture(a["TEXTURE".concat(p)]),a.bindTexture(a.TEXTURE_2D,y.texture),y.updateTexture());u.forEach((b)=>{f[b.name].setValue(b.u);a.activeTexture(a["TEXTURE".concat(b.u)]);a.bindTexture(a.TEXTURE_2D,b.fbo.texture);b.fbo.updateTexture()})}let g=4<arguments.length&&void 0!==arguments[4]?arguments[4]:!1,n=ma++,l=a.createProgram(),k=a.createBuffer();var m=L(a,
a.VERTEX_SHADER,d);let r=L(a,a.FRAGMENT_SHADER,ia(c,g));a.attachShader(l,m);a.attachShader(l,r);a.linkProgram(l);let q,t,w,y,p,x=Y(a,l),f=ha(a,l),u=new Set,v=new Set,z=0;if(!a.getProgramParameter(l,a.LINK_STATUS)){let b=a.getProgramInfoLog(l);console.warn(b)}a.detachShader(l,m);a.detachShader(l,r);a.deleteShader(m);a.deleteShader(r);m=x.position;a.bindBuffer(a.ARRAY_BUFFER,k);a.bufferData(a.ARRAY_BUFFER,b,a.STATIC_DRAW);a.enableVertexAttribArray(m);a.vertexAttribPointer(m,2,a.FLOAT,!1,0,0);return{get id(){return n},
get nodes(){return u},get fbo(){return w},get name(){return q},get u(){return t},render:function(b,c,d){u.size&&u.forEach((a)=>a.render(b,c,d));if(w){if(y){let a=w;w=y;y=a}w.updateResolution(b,c);w.bind()}else a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,b,c);a.clear(a.COLOR_BUFFER_BIT);a.useProgram(l);h(d);a.drawArrays(a.TRIANGLES,0,6)},addNode:function(a,b,c){a.toFbo(b,z++,c);u.add(a)},removeNode:function(a){u.delete(a)},addTexture:function(a){v.add(a)},removeTexture:function(a){v.delete(a)},
getTexUnit:function(){return z++},update:h,toFbo:function(b,c,d){q=b;t=c;w=K(a);d&&(y=K(a),p=z++)},dispose:function(){v.forEach((a)=>a.dispose());v.clear();a.deleteProgram(l)}}}function N(a,d){function c(){a.getParameter(a.ACTIVE_TEXTURE)!==d&&a.activeTexture(a["TEXTURE".concat(d)])}function b(){c();a.bindTexture(g,n)}function e(c){if("object"===typeof c){Object.assign(l,c);b();var {level:c,internalFormat:d,offsetX:e,offsetY:w,width:h,height:p,border:r,format:f,type:u,flipY:v,buffer:z,pixels:n}=l;
a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,v);if(n){{var {pixels:v}=l;n=a.getTexParameter(g,a.TEXTURE_WRAP_S);let b=a.getTexParameter(g,a.TEXTURE_WRAP_T),c=a.getTexParameter(g,a.TEXTURE_MIN_FILTER),d=E(v.width)&&E(v.height);n===a.CLAMP_TO_EDGE&&b===a.CLAMP_TO_EDGE&&(c===a.LINEAR||c===a.NEAREST)||d||(m||(m=document.createElement("canvas"),m.width=2**Math.floor(Math.log(v.width)/Math.LN2),m.height=2**Math.floor(Math.log(v.height)/Math.LN2),console.warn("Texture is not power of two ".concat(v.width," x ").concat(v.height,
". Resized to ").concat(m.width," x ").concat(m.height,";"))),m.getContext("2d").drawImage(v,0,0,m.width,m.height));k=m||v}}"number"===typeof e&&"number"===typeof w?k?a.texSubImage2D(g,c,e,w,f,u,k):a.texSubImage2D(g,c,e,w,h,p,f,u,z):k?a.texImage2D(g,c,d,f,u,k):a.texImage2D(g,c,d,h,p,r,f,u,z);k&&E(k.width)&&E(k.height)&&(c=a.getTexParameter(g,a.TEXTURE_MIN_FILTER),c!==a.LINEAR&&c!==a.NEAREST&&a.generateMipmap(g))}}let h=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},g=a.TEXTURE_2D,n=a.createTexture(),
l={},k,m;e(Object.assign({level:0,internalFormat:a.RGBA,offsetX:null,offsetY:null,width:1,height:1,border:0,format:a.RGBA,type:a.UNSIGNED_BYTE,flipY:!0,buffer:na,pixels:null},"object"===typeof h?h:{}));return{bind:b,setParameters:function(b){c();b.forEach((b)=>{let [c,d]=b;a.texParameteri(g,c,d)})},update:e,dispose:function(){a.deleteTexture(n)}}}function oa(a){return new Promise((d,c)=>{let b=new XMLHttpRequest;b.open("GET",a,!0);b.responseType="arraybuffer";b.onreadystatechange=()=>{b.readyState===
XMLHttpRequest.DONE&&(200===b.status||206===b.status?d(b.response):(console.log(b),c(b.status)))};b.send()})}function pa(a,d){return new Promise((c,b)=>{d.decodeAudioData(a,c,b)})}function qa(a,d,c,b,e,h,g,n){async function l(){x=r.createBufferSource();x.buffer=await pa(await oa(b),r);x.loop=h;x.start();f=!0}function k(){let a=document.querySelector(b);a&&a instanceof HTMLAudioElement&&(p=a,x=r.createMediaElementSource(a))}function m(a,b){a.connect(q);q.connect(b)}e=a.gl;let r=a.wa,q=r.createAnalyser();
q.fftSize=1024;let t=new Uint8Array(q.frequencyBinCount),w=new Uint8Array(q.frequencyBinCount),y=N(e,d,{internalFormat:e.LUMINANCE,width:w.length,height:2,format:e.LUMINANCE,buffer:null});y.setParameters([[e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE],[e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE],[e.TEXTURE_MIN_FILTER,e.NEAREST]]);let p,x,f=!1,u=[{name:c,value:d}];"#"===b[0]?k():b&&l();x&&m(x,r.destination);return{update:function(a){u.forEach(a);if(f||p&&2<p.readyState&&!p.paused&&!p.ended&&p.currentTime)q.getByteFrequencyData(t),
q.getByteTimeDomainData(w),y.update({offsetX:0,offsetY:0,height:1,buffer:t}),y.update({offsetX:0,offsetY:1,height:1,buffer:w})}}}function O(a,d){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(a);d&&(b=b.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable}));c.push.apply(c,b)}return c}function ra(a,d,c,b,e,h,g,n,l,k){function m(){u=0;f=new Image;f.crossOrigin="anonymous";f.onload=r;f.onerror=()=>{console.warn("failed loading src: ".concat(b))};
f.src=b}function r(){y();x.setParameters([[p.TEXTURE_WRAP_S,h],[p.TEXTURE_WRAP_T,g],[p.TEXTURE_MIN_FILTER,n],[p.TEXTURE_MAG_FILTER,l]]);x.update({pixels:f})}function q(){u=1;f=document.createElement("video");f.autoplay=!0;f.muted=!0;f.loop=!0;f.playsInline=!0;f.crossOrigin="anonymous";f.src=b;let a=document.createElement("div");a.style.width=a.style.height="1px";a.style.overflow="hidden";a.style.position="absolute";a.style.opacity="0";a.style.pointerEvents="none";a.style.zIndex="-1000";a.appendChild(f);
document.body.appendChild(a);t();f.play()}function t(){y();x.setParameters([[p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE],[p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE],[p.TEXTURE_MIN_FILTER,p.LINEAR]])}function w(){u=2;let a=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,b=(a)=>{f=document.createElement("video");f.width=320;f.height=240;f.autoplay=!0;f.srcObject=a;t()},c=()=>{navigator.mediaDevices.getUserMedia({video:!0}).then(b).catch((a)=>console.log(a.name+": "+a.message))},d=()=>{a({video:!0},
b,(a)=>a)};navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?c():a&&d()}function y(){f&&(v[1].value[0]=f.width,v[1].value[1]=f.height)}let p=a.gl,x=N(p,d),f,u,v=[{name:c,value:d},{name:c+"_resolution",value:[0,0]}];if(e)w();else if(sa.test(b))q();else if(ta.test(b))m();else{try{f=document.querySelector(b)}catch(z){console.warn("src: ".concat(b,": invalid selector"))}f?f instanceof HTMLImageElement?(u=0,f.complete?r():f.addEventListener("load",r)):f instanceof HTMLVideoElement?(u=1,t()):
f instanceof HTMLCanvasElement?(u=3,r()):console.warn("src: ".concat(b,": element is not a valid texture source")):console.warn("src: ".concat(b,": no element could be selected"))}return{update:function(a){v.forEach(a);k||(2===u||1===u)&&f instanceof HTMLVideoElement&&f.readyState===f.HAVE_ENOUGH_DATA?x.update({pixels:f}):x.bind()}}}function ua(a,d){function c(a){l.forEach((a)=>"function"===typeof a&&a());t=!0;a=P(a);let {top:b,left:c,height:d}=m;k[1].toyvalue[2]=a[0]-Math.floor(c);k[1].toyvalue[3]=
Math.floor(d)-(a[1]-Math.floor(b))}function b(a){if(!q){a=P(a);let {top:b,left:c,height:d}=m;k[1].value[0]=a[0]-Math.floor(c);k[1].value[1]=Math.floor(d)-(a[1]-Math.floor(b));t&&(k[1].toyvalue[0]=k[1].value[0],k[1].toyvalue[1]=k[1].value[1]);q=!0}}function e(a){t=!1;k[1].toyvalue[2]=0;k[1].toyvalue[3]=0}function h(){let a=g.getBoundingClientRect();r=0<=a.top+a.height&&0<=a.left+a.width&&a.bottom-a.height<=(window.innerHeight||document.documentElement.clientHeight)&&a.right-a.width<=(window.innerWidth||
document.documentElement.clientWidth);a.width!==m.width&&(g.width=k[0].value[0]=a.width);a.height!==m.height&&(g.height=k[0].value[1]=a.height);m=a}let g=a instanceof HTMLCanvasElement?a:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=g.getContext("2d"),l=new Set,k=JSON.parse(JSON.stringify(Q)),m={},r,q,t;g.addEventListener("mousedown",c);g.addEventListener("mousemove",b);g.addEventListener("mouseup",e);g.addEventListener("mouseout",e);g.addEventListener("touchstart",c);g.addEventListener("touchmove",
b);g.addEventListener("touchend",e);h();return Object.freeze({get dom(){return g},render:function(a,b,c,e,f,g){h();q=!1;if(r&&d){var l=m.width||0;c=m.height||0;b(l,c);d.render(l,c,[...g,...k]);b=l*f;f*=c;n.clearRect(0,0,b,f);n.drawImage(a,0,e-f,b,f,0,0,b,f)}},addClick:function(a){l.add(a)},dispose:function(){l.clear();g.removeEventListener("mousedown",c);g.removeEventListener("mousemove",b);g.removeEventListener("mouseup",e);g.removeEventListener("mouseout",e);g.removeEventListener("touchstart",c);
g.removeEventListener("touchmove",b);g.removeEventListener("touchend",e)}})}var R={render(){return"".concat(this.css(),"\n            ").concat(this.html())},map(a){return{canvas:a.querySelector("canvas")}},html(a){return"<canvas></canvas>"},css(){return"<style>\n      :host {\n        position: relative;\n        display: inline-block;\n        width: 250px;\n        height: 250px;\n      }\n      :host > canvas {\n        position: absolute;\n        top: 0;\n        left: 0;\n        height: 100%;\n        width: 100%;\n        border-radius: inherit;\n       }\n    </style>"}};
let J=[{name:"u_time",toyname:"iTime",type:"float",value:0},{name:"u_delta",toyname:"iTimeDelta",type:"float",value:0},{name:"u_date",toyname:"iDate",type:"vec4",value:[0,0,0,0]},{name:"u_frame",toyname:"iFrame",type:"int",value:0}],Q=[{name:"u_resolution",toyname:"iResolution",type:"vec2",value:[0,0]},{name:"u_mouse",toyname:"iMouse",type:"vec2",toytype:"vec4",value:[0,0],toyvalue:[0,0,0,0]}],I=[{name:"u_orientation",toyname:"iOrientation",type:"vec3",value:[0,0,0]}],ka=[...J,...I,...Q],M=/\(\s*out\s+vec4\s+(\S+)\s*,\s*in\s+vec2\s+(\S+)\s*\)/,
B;A.singleton=function(){B||(B=A());return B};A.resetSingleton=function(){B.dispose();B=A()};class F extends HTMLElement{get renderer(){return A.singleton()}get name(){return this.getAttribute("name")}set name(a){this.setAttribute("name",a)}}var D=(a,d,c)=>{if(!d)return a[c];d="toy".concat(c);return a.hasOwnProperty(d)?a[d]:a[c]},ja=(a,d)=>Object.values(a).reduce((a,b)=>a+"uniform ".concat(D(b,d,"type")," ").concat(D(b,d,"name"),";\n"),"");let ma=0;var va=(a)=>new Promise((d,c)=>{let b=new XMLHttpRequest;
b.open("GET",a);b.onreadystatechange=()=>{b.readyState===XMLHttpRequest.DONE&&(200===b.status?d(b.responseText):c(b.status))};b.send()}),S=async(a)=>a.src?va(a.src):a.text;let T=new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),wa=0;class U extends F{disconnectedCallback(){this.program.dispose();this.program=void 0}get shadertoy(){return this.hasAttribute("shadertoy")}set shadertoy(a){a?this.setAttribute("shadertoy",""):this.removeAttribute("shadertoy")}get prevbuffer(){return this.hasAttribute("prevbuffer")}set prevbuffer(a){a?
this.setAttribute("prevbuffer",""):this.removeAttribute("prevbuffer")}get vertices(){let a=this.getAttribute("vertices");if(!a)return T;a=JSON.parse(a);return Array.isArray(a)?new Float32Array(a):T}set vertices(a){a&&Array.isArray(a)&&this.setAttribute("vertices",JSON.stringify(a))}async init(a){a&&!this.name&&(this.name="".concat("u_node").concat(wa++));let d=[],c,b;for(let a=0;a<this.children.length;a++){let e=this.children[a];if(e instanceof F)d.push(e);else switch(e.getAttribute("type")){case "x-shader/x-fragment":b=
await S(e);break;case "x-shader/x-vertex":c=await S(e)}}this.program=la(this.renderer.gl,c||"attribute vec2 position;\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n}",b,this.vertices,this.shadertoy);d.forEach((a)=>{a.init(this.program)});a&&a.addNode(this.program,this.name,this.prevbuffer)}}customElements.get("sd-node")||customElements.define("sd-node",U);let na=new Uint8Array([0,0,0,255]),E=(a)=>!(a&a-1)&&!!a,xa=0;class ya extends F{disconnectedCallback(){this.program.removeTexture(this.texture);
this.texture.dispose()}get src(){return this.getAttribute("src")}set src(a){this.setAttribute("src",a)}get autoplay(){return this.hasAttribute("autoplay")}set autoplay(a){a?this.setAttribute("autoplay",""):this.removeAttribute("autoplay")}get loop(){return this.hasAttribute("loop")}set loop(a){a?this.setAttribute("loop",""):this.removeAttribute("loop")}get crossOrigin(){return this.getAttribute("crossorigin")}set crossOrigin(a){this.setAttribute("crossorigin",a)}get mic(){return this.hasAttribute("mic")}set mic(a){a?
this.setAttribute("mic",""):this.removeAttribute("mic")}init(a){this.name||(this.name="".concat("u_audio").concat(xa++));this.src&&(this.program=a,this.texture=qa(this.renderer,a.getTexUnit(),this.name,this.src,this.mic,this.loop,this.autoplay,this.crossOrigin),a.addTexture(this.texture))}}customElements.get("sd-audio")||customElements.define("sd-audio",ya);let ta=/(\.jpg|\.jpeg|\.png|\.gif|\.bmp)$/i,sa=/(\.mp4|\.3gp|\.webm|\.ogv)$/i,V={NEAREST:9728,LINEAR:9729},za=function(a){for(var d=1;d<arguments.length;d++){var c=
null!=arguments[d]?arguments[d]:{};d%2?O(c,!0).forEach(function(b){var d=c[b];b in a?Object.defineProperty(a,b,{value:d,enumerable:!0,configurable:!0,writable:!0}):a[b]=d}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):O(c).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}({},V,{NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987}),W={REPEAT:10497,
MIRRORED_REPEAT:33648,CLAMP_TO_EDGE:33071},Aa=0;class Ba extends F{static get observedAttributes(){return"mag-filter min-filter name src wrap-s wrap-t".split(" ")}disconnectedCallback(){this.program.removeTexture(this.texture);this.texture.dispose()}get forceUpdate(){return this.hasAttribute("force-update")}set forceUpdate(a){a?this.setAttribute("force-update",""):this.removeAttribute("force-update")}get magFilter(){return V[this.getAttribute("mag-filter")]||9729}get minFilter(){return za[this.getAttribute("min-filter")]||
9987}get src(){return this.getAttribute("src")}set src(a){this.setAttribute("src",a)}get webcam(){return this.hasAttribute("webcam")}set webcam(a){a?this.setAttribute("webcam",""):this.removeAttribute("webcam")}get wrapS(){return W[this.getAttribute("wrap-s")]||10497}get wrapT(){return W[this.getAttribute("wrap-t")]||10497}init(a){this.name||(this.name="".concat("u_texture").concat(Aa++));if(this.src||this.webcam)this.program=a,this.texture=ra(this.renderer,a.getTexUnit(),this.name,this.src,this.webcam,
this.wrapS,this.wrapT,this.minFilter,this.magFilter,this.forceUpdate),a.addTexture(this.texture)}}customElements.get("sd-texture")||customElements.define("sd-texture",Ba);let Ca=new Set(["touchstart","touchmove","touchend"]);var P=(a)=>{a=Ca.has(a.type)&&"object"===typeof a.touches[0]?a.touches[0]:a;return[a.clientX||0,a.clientY||0]};class Da extends U{constructor(){super();this.shadow=this.attachShadow({mode:"open"})}connectedCallback(){setTimeout(()=>{try{this.init()}catch(a){console.error(a&&a.message||
"Error in shader-doodle.")}})}disconnectedCallback(){super.disconnectedCallback();this.renderer.removeSurface(this.surface);this.surface.dispose();this.surface=void 0}async init(){this.shadow.innerHTML=R.render();let a=R.map(this.shadow).canvas;await super.init();this.surface=ua(a,this.program);this.renderer.addSurface(this.surface)}}customElements.get("shader-doodle")||customElements.define("shader-doodle",Da)});